<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Viewing</title>
</head>
<body>
    <h1>Viewing</h1>
    <video id="remoteVideo" autoplay></video>

    <script>
        let peerConnection;

        const signalingSocket = new WebSocket('https://argos-online.onrender.com');

        signalingSocket.onopen = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const password = urlParams.get('password');

            // ルームに参加するためのメッセージを送信
            signalingSocket.send(JSON.stringify({ type: 'join', password }));
        };

        signalingSocket.onmessage = async (message) => {
            const data = JSON.parse(message.data);
            if (data.type === 'offer') {
                peerConnection = new RTCPeerConnection();

                // 受信したOfferに対する応答を作成
                await peerConnection.setRemoteDescription(new RTCSessionDescription(data.offer));
                const answer = await peerConnection.createAnswer();
                await peerConnection.setLocalDescription(answer);

                // Answerをシグナリングサーバーに送信
                signalingSocket.send(JSON.stringify({ type: 'answer', answer }));

                // Remote Streamの受信処理
                peerConnection.ontrack = (event) => {
                    document.getElementById('remoteVideo').srcObject = event.streams[0];
                };
            }
        };
    </script>
</body>
</html>
